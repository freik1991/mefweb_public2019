<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" lang="es" xml:lang="es">
<f:view >

	<h:body style="margin: 0px;">
		<div class="ui-g" style="margin: 0px; ">
			<ui:include src="WEB-INF/topbar.xhtml"/>
			<div class="ui-g-12">
				<div class="card" style="height: 100%">
					<p:outputLabel  styleClass="card-title" value="CONTROL DE DISPOSITIVOS GPS" />
					<p:separator  styleClass="card-title" />
					<h:form id="frmGps">
					<p:dataTable
						id="dtbGps" 
						var="gps" 
						value="#{gpsController.listGps}"
						widgetVar="wgvListgps"
						filteredValue="#{gpsController.filterListGps}"
						style="text-align: center;"
						rows="50"
						paginator="true"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowIndexVar="index"
						rowStyleClass="#{gps.isActive eq 2?'colorRED':null}"
						rowsPerPageTemplate="50,100,150"
						paginatorPosition="bottom"
						emptyMessage="0 registros...!!!">
						<f:facet name="header">
							<div class="ui-g">
								<div class="ui-g-6">
									<p:outputPanel style="margin-left:0px !important; text-align:left;">
										<p:commandButton
											icon="fa fa-refresh"
											value="Actualizar Lista"
											style="width: 200px;"
											actionListener="#{gpsController.init}"
											update=":frmGps:dtbGps :frmMessages:messages"
											oncomplete="PF('wgvListgps').filter()" />
										<p:spacer width="30" />
										<h:outputText value="Buscar (*): " />
										<p:spacer width="5" />
										<p:inputText
											id="globalFilter"
											style="width:180px"
											placeholder="Ingrese un ESN" />
										<p:spacer width="10px" />
										<p:commandButton
											onclick="PF('wgvListgps').filter()"
											icon="pi pi-search" /> 
										<p:spacer width="5" />
										<p:commandButton
											onclick="PF('wgvListgps').clearFilters()"
											icon="pi pi-ban" />
									</p:outputPanel>
								</div>
								<div class="ui-g-6">
									<p:outputPanel style="margin-rigth:0px !important;text-align:right;">
										<p:commandButton
											icon="fa fa-plus"
											value="Nuevo GPS"
											oncomplete="PF('wgvNewGps').show();"
											title="Nuevo GPS"
											style="margin-right:0px; bottom:5px; width:auto;"
											actionListener="#{gpsController.voidNewGps}"
											update=":frmNewGps:oppNewGps :frmMessages:messages"/>
										<p:spacer width="20" />
										
										<h:commandLink>
											<p:graphicImage
												url="/images/excel.png"
												width="24" />
											<p:dataExporter
												type="xls"
												target="dtbGps"
												fileName="Gps" />
										</h:commandLink>
										<p:spacer width="20" />
										
									</p:outputPanel>
								</div>
							</div>
					    </f:facet>
						
					
					    <p:column headerText="GPSID" width="60"><h:outputText value="#{gps.gpsID}" /></p:column>
					    <p:column  style="white-space:nowrap; text-align:left;" filterBy="#{gps.accountID}" filterMatchMode="exact">
				            <f:facet name="filter">
				            	
				                <p:selectOneMenu 
									onchange="PF('wgvListgps').filter()"
									style="width:250px;"
									label="Cuenta"
									scrollHeight="150" >
									<f:selectItem itemLabel="Todas las cuentas" itemValue="#{null}" noSelectionOption="true"/>
									<f:selectItems
										value="#{gpsController.listAccount}"
										var="account"
										itemValue="#{account.accountID}"
										itemLabel="#{account.uniqueID} - #{account.bussinessName}" />
								</p:selectOneMenu>
				            </f:facet>			    
					    
					   		 <h:outputText value="#{gps.bussinessName}" /></p:column>
					    <p:column headerText="Vehiculo" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.vehicleName}" /></p:column>
					    <p:column headerText="ESN*" width="120"
					    		filterBy="#{gps.esn}"
								filterStyle="display: none; visibility: hidden;">
								<h:outputText value="#{gps.esn}" /></p:column>
					    <p:column headerText="Tipo" width="140" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.name}" /></p:column>
					    <p:column headerText="SIM" width="90"><h:outputText value="#{gps.sim}" /></p:column>
					    <p:column headerText="GPS Time" width="120"><h:outputText value="#{gps.lastGpsTimestampTxt}" /></p:column>
					    <p:column headerText="Active" width="50"><h:outputText value="#{gps.isActiveTxt}" /></p:column>
					    <p:column headerText="Recepción" width="100"><h:outputText value="#{gps.deliveryDateTxt}" /></p:column>
					    <p:column headerText="Creación" width="120"><h:outputText value="#{gps.creationTimeTxt}" /></p:column>
					    <p:column headerText="Actualizado" width="120"><h:outputText value="#{gps.lastUpdateTimeTxt}" /></p:column>
						<p:column
							headerText="Accciones"
							style="width:80px;"
							exportable="false">
							<h:panelGrid
								columns="3"
								styleClass="bordernone">
								<p:commandLink
									update=":frmViewGps:oppViewGps :frmMessages:messages"
									actionListener="#{gpsController.selectGpsID(gps.gpsID)}"
									oncomplete="PF('wgvViewGps').show();"
									title="Mostrar">
									<i class="pi pi-search"></i>
								</p:commandLink>
								<p:commandLink
									update=":frmEditGps:oppEditGps :frmMessages:messages"
									actionListener="#{gpsController.voidEditGps(gps.gpsID)}"
									oncomplete="PF('wgvEditGps').show();"
									title="Editar GPS">
									<i class="pi pi-pencil"></i>
								</p:commandLink>
							</h:panelGrid>
						</p:column>
					</p:dataTable>
					</h:form>
				</div>
			</div>
		</div>

		<h:form id="frmNewGps">
			<p:dialog header="Nuevo Dispositivo GPS"
				widgetVar="wgvNewGps" resizable="false"
				id="dlgNewGps" showEffect="fade" hideEffect="clip" modal="true">
				<p:outputPanel id="oppNewGps">
					<h:panelGrid columns="3" cellpadding="5">
						<p:outputLabel for="txtesn" style="font-weight: bold;" value="Nº de ESN:"/>
						<p:inputText id="txtesn" value="#{gpsController.selectGps.esn}" required="true" size="22" />
						<p:message for="txtesn" display="icon" />
						
						<p:outputLabel for="txtgpsTypeID" style="font-weight: bold;" value="Tipo de GPS:"/>
						<p:selectOneMenu id="txtgpsTypeID" value="#{gpsController.selectGps.gpsTypeID}" effect="fade" required="true" style="width: 200px;">
							<f:selectItems value="#{gpsController.listGpsType}" 
											var="gpsType" itemLabel="#{gpsType.name}" itemValue="#{gpsType.gpsTypeID}" />
						</p:selectOneMenu>
						<p:message for="txtgpsTypeID" display="icon" />
						
						<p:outputLabel for="txtaccountID" style="font-weight: bold;" value="Cuenta Asignada:"/>
						<p:selectOneMenu id="txtaccountID" value="#{gpsController.selectGps.accountID}" effect="fade" required="true" style="width: 420px;">
							<p:ajax
								listener="#{gpsController.onAccountChangeNew}"
								update="txtvehicleID :frmMessages:messages" />
							<f:selectItem itemLabel="Elija la cuenta..." itemValue="-1" noSelectionOption="true" />
							<f:selectItems value="#{gpsController.listAccount}" 
											var="account" itemLabel="#{account.bussinessName}" itemValue="#{account.accountID}" />
						</p:selectOneMenu>
						<p:message for="txtaccountID" display="icon" />
						
						<p:outputLabel for="txtvehicleID" style="font-weight: bold;" value="Vehiculo Asignado:"/>
						<p:selectOneMenu id="txtvehicleID" value="#{gpsController.selectGps.vehicleID}" effect="fade" 
										filter="true" filterMatchMode="contains" style="width: 200px;">
							<f:selectItem itemLabel="Elija al vehiculo..." itemValue="-1" />
							<f:selectItems value="#{gpsController.listVehicle}" 
											var="vehicle" itemLabel="#{vehicle.vehicleName}" itemValue="#{vehicle.vehicleID}" />
						</p:selectOneMenu>
						<p:message for="txtvehicleID" display="icon" />
						
						<p:outputLabel for="txtchipID" style="font-weight: bold;" value="Chip Asignado:"/>
						<p:selectOneMenu id="txtchipID" value="#{gpsController.selectGps.chipID}" effect="fade" 
										filter="true" filterMatchMode="contains" style="width: 200px;">
							<f:selectItem itemLabel="Elija al Chip..." itemValue="-1" />
							<f:selectItems value="#{gpsController.listChip}" 
											var="chip" itemLabel="#{chip.sim}" itemValue="#{chip.chipID}" />
						</p:selectOneMenu>
						<p:message for="txtchipID" display="icon" />
						
						<p:outputLabel for="txtdescription" style="font-weight: bold;" value="Referencia:"/>
						<p:inputText id="txtdescription" value="#{gpsController.selectGps.description}" size="52"  />
						<p:spacer />
						
						<p:outputLabel for="txtnotes" style="font-weight: bold;" value="Nota:"/>
						<p:inputTextarea id="txtnotes" rows="6" cols="52" value="#{gpsController.selectGps.notes}" />
						<p:spacer />

						<p:outputLabel for="txtdeliveryDate" style="font-weight: bold;" value="Recepcionado el:"/>
						<p:calendar id="txtdeliveryDate" value="#{gpsController.selectGps.deliveryDateChange}" showOn="button" pattern="dd-MM-yyyy" />
						<p:spacer />
						
					</h:panelGrid>
					<p:separator></p:separator>
					<h:panelGrid
						columns="2"
						style="  float:right;">
						<p:commandButton
							value="Grabar"
							actionListener="#{gpsController.voidSaveNewGps}"
							update=":frmGps:dtbGps :frmMessages:messages"
							oncomplete="PF('wgvListgps').filter()" >
						</p:commandButton>
						<p:commandButton
							value="Cancelar"
							onclick="PF('wgvNewGps').hide();" />
					</h:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>
		<h:form id="frmEditGps">
			<p:dialog header="Editar Dispositivo GPS"
				widgetVar="wgvEditGps" resizable="false"
				id="dlgEditGps" showEffect="fade" hideEffect="clip" modal="true">
				<p:outputPanel id="oppEditGps">
					<h:panelGrid columns="3" cellpadding="5">
						<p:outputLabel style="font-weight: bold;" value="Nº de ESN:"/>
						<p:outputLabel value="#{gpsController.selectGps.esn}"/>
						<p:spacer />
						
						<p:outputLabel for="txtgpsTypeID" style="font-weight: bold;" value="Tipo de GPS:"/>
						<p:selectOneMenu id="txtgpsTypeID" value="#{gpsController.selectGps.gpsTypeID}" effect="fade" required="true" style="width: 200px;">
							<f:selectItems value="#{gpsController.listGpsType}" 
											var="gpsType" itemLabel="#{gpsType.name}" itemValue="#{gpsType.gpsTypeID}" />
						</p:selectOneMenu>
						<p:message for="txtgpsTypeID" display="icon" />
						
						<p:outputLabel for="txtaccountID" style="font-weight: bold;" value="Cuenta Asignada:"/>
						<p:selectOneMenu id="txtaccountID" value="#{gpsController.selectGps.accountID}" effect="fade" required="true" style="width: 420px;">
							<p:ajax
								listener="#{gpsController.onAccountChangeNew}"
								update="txtvehicleID :frmMessages:messages" />
							<f:selectItem itemLabel="Elija la cuenta..." itemValue="-1" noSelectionOption="true" />
							<f:selectItems value="#{gpsController.listAccount}" 
											var="account" itemLabel="#{account.bussinessName}" itemValue="#{account.accountID}" />
						</p:selectOneMenu>
						<p:message for="txtaccountID" display="icon" />
						
						<p:outputLabel for="txtvehicleID" style="font-weight: bold;" value="Vehiculo Asignado:"/>
						<p:selectOneMenu id="txtvehicleID" value="#{gpsController.selectGps.vehicleID}" effect="fade" 
										filter="true" filterMatchMode="contains" style="width: 200px;">
							<f:selectItem itemLabel="Elija al vehiculo..." itemValue="-1" />
							<f:selectItems value="#{gpsController.listVehicle}" 
											var="vehicle" itemLabel="#{vehicle.vehicleName}" itemValue="#{vehicle.vehicleID}" />
						</p:selectOneMenu>
						<p:message for="txtvehicleID" display="icon" />
						
						<p:outputLabel for="txtchipID" style="font-weight: bold;" value="Chip Asignado:"/>
						<p:selectOneMenu id="txtchipID" value="#{gpsController.selectGps.chipID}" effect="fade" 
										filter="true" filterMatchMode="contains" style="width: 200px;">
							<f:selectItem itemLabel="Elija al Chip..." itemValue="-1" />
							<f:selectItems value="#{gpsController.listChip}" 
											var="chip" itemLabel="#{chip.sim}" itemValue="#{chip.chipID}" />
						</p:selectOneMenu>
						<p:message for="txtchipID" display="icon" />
						
						<p:outputLabel for="txtdescription" style="font-weight: bold;" value="Referencia:"/>
						<p:inputText id="txtdescription" value="#{gpsController.selectGps.description}" size="52" />
						<p:spacer />
						
						<p:outputLabel for="txtnotes" style="font-weight: bold;" value="Nota:"/>
						<p:inputTextarea id="txtnotes" rows="6" cols="52" value="#{gpsController.selectGps.notes}" />
						<p:spacer />

						<p:outputLabel for="txtdeliveryDate" style="font-weight: bold;" value="Recepcionado el:"/>
						<p:calendar id="txtdeliveryDate" value="#{gpsController.selectGps.deliveryDateChange}" showOn="button" pattern="dd-MM-yyyy" />
						<p:spacer />
						
						<p:outputLabel for="txtisActive" style="font-weight: bold;" value="Activo:"/>
						<p:selectBooleanCheckbox id="txtisActive" value="#{gpsController.selectGps.isActiveChange}" />
						<p:spacer />

					</h:panelGrid>
					<p:separator></p:separator>
					<h:panelGrid
						columns="2"
						style="  float:right;">
						<p:commandButton
							value="Grabar"
							actionListener="#{gpsController.voidSaveEditGps}"
							update=":frmGps:dtbGps :frmMessages:messages"
							oncomplete="PF('wgvListgps').filter()" >
						</p:commandButton>
						<p:commandButton
							value="Cancelar"
							onclick="PF('wgvEditGps').hide();" />
					</h:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>
		<h:form id="frmViewGps">
			<p:dialog header="Ver Historial del Dispositivo GPS"
				widgetVar="wgvViewGps" resizable="false" width="1000"
				id="dlgViewGps" showEffect="fade" hideEffect="clip" modal="true">
				<p:outputPanel id="oppViewGps">
					<div class="ui-g">
						<div class="ui-g-6">
							<h:panelGrid columns="2" cellpadding="5">
								<p:outputLabel style="font-weight: bold;" value="Nº de ESN:"/>
								<p:outputLabel value="#{gpsController.selectGps.esn}"/>
								<p:outputLabel style="font-weight: bold;" value="Cuenta Asignada:"/>
								<p:outputLabel value="#{gpsController.selectGps.bussinessName}"/>
								<p:outputLabel style="font-weight: bold;" value="Chip Asignado:"/>
								<p:outputLabel value="#{gpsController.selectGps.sim}"/>
							</h:panelGrid>
						</div>
						<div class="ui-g-6">
							<h:panelGrid columns="2" cellpadding="5">
								<p:outputLabel style="font-weight: bold;" value="Tipo de GPS:"/>
								<p:outputLabel value="#{gpsController.selectGps.name}"/>
								<p:outputLabel style="font-weight: bold;" value="Vehiculo Asignado:"/>
								<p:outputLabel value="#{gpsController.selectGps.vehicleName}"/>
								<p:outputLabel style="font-weight: bold;" value="Recepcionado el:"/>
								<p:outputLabel value="#{gpsController.selectGps.deliveryDateTxt}"/>
							</h:panelGrid>
						</div>
					</div>
					<div class="ui-g">
					<div class="ui-g-12">
					<h:panelGrid columns="2" cellpadding="5">
						<p:outputLabel style="font-weight: bold;" value="Referencia:"/>
						<p:outputLabel value="#{gpsController.selectGps.description}"/>
						<p:outputLabel style="font-weight: bold;" value="Nota:"/>
						<p:outputLabel value="#{gpsController.selectGps.notes}"/>
					</h:panelGrid>
					</div>
					</div>
					<p:dataTable
						id="dtbViewGps" 
						var="gps" 
						value="#{gpsController.listHistoryGps}"
						style="text-align: center;"
						rowIndexVar="index"
						scrollable="true" scrollHeight="200"
						emptyMessage="0 registros...!!!">
						<p:column headerText="Cuenta Anterior" width="220" style="white-space:nowrap; text-align:left;"><h:outputText value="#{gps.bussinessNameOld}" /></p:column>
						<p:column headerText="Cuenta Actual" width="220" style="white-space:nowrap; text-align:left;"><h:outputText value="#{gps.bussinessName}" /></p:column>
					    <p:column headerText="Vehiculo Anterior" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.vehicleNameOld}" /></p:column>
					    <p:column headerText="Vehiculo Actual" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.vehicleName}" /></p:column>
					    <p:column headerText="SIM Anterior" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.simOld}" /></p:column>
					    <p:column headerText="SIM Actual" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.sim}" /></p:column>
					    <p:column headerText="Tipo Anterior" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.nameOld}" /></p:column>
					    <p:column headerText="Tipo Actual" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.name}" /></p:column>
					    <p:column headerText="Estado Anterior" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.isActiveOldTxt}" /></p:column>
					    <p:column headerText="Estado Actual" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.isActiveTxt}" /></p:column>
					    <p:column headerText="Realizado el" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.creationTimeTxt}" /></p:column>
					    <p:column headerText="usuario" width="120" style="white-space:nowrap; text-align:center;"><h:outputText value="#{gps.userName}" /></p:column>
							
							
							
					</p:dataTable>
					<p:separator></p:separator>
					<h:panelGrid
						columns="2"
						style="float:right;">
						<p:spacer />
						<p:commandButton
							value="Cerrar"
							onclick="PF('wgvViewGps').hide();" />
					</h:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>

</h:body>
</f:view>
</html>